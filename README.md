### 登录
- 媒体服务器与信令服务器一直保持连接

- 客户端登陆后与信令服务器建立ws连接

- 信令服务器保存用户的信息

- 客户端通过定时给信令服务器发送心跳包来告知信令服务器自己还在线

### 申请发言
客户端给信令服务器发送「申请发言」的消息。

1.信令服务器收到消息后
- 将该客户端的状态修改为发言人，并返回当前发言的人数。
- 将消息转发给其它状态为发言人的客户端
- 将消息转发给媒体服务器。

2.申请发言的客户端收到响应后
- 停止监听原来的接收数据端口
- 开始通过原来的接收数据端口向媒体服务器发送数据
- 与媒体服务器进行「接收其他发言者数据」的下行端口的打洞流程。
- 打洞成功后监听新增的这些端口，接收音频数据并进行混流播放

3.其他状态为发言人的客户端收到消息后
- 与媒体服务器进行「接收新增发言者数据」的下行端口的打洞流程。
- 打洞成功后监听新增下行端口，接收音频数据。

4.媒体服务器收到申请发言消息后
- 将该客户端转变为发言人
- 停止往该客户端发送数据
- 开始监听该客户端原来的发送端口，准备接收音频数据
- 在与该客户端的打洞流程成功后，开始转发其他发言者的音频数据给新增发言者。
- 在于其他发言者的打洞流程成功后，将新增发言者的音频数据转发给其他发言者。


此时，媒体服务器统一收到多个发言者客户端发送音频数据，为每个发言者客户端维护一个音频包的队列，当收到某一个客户端发来的音频包时，
直接将它转发给其它发言者客户端，并清空对应音频包队列，将新收到的音频包入队。媒体服务器在创建房间时启动一个线程，这个线程以一定
速率获取各个队列中的音频包，经过解码、混流、编码后发送给所有状态为非发言者的客户端。

